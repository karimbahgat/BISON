{% load static %}

<link rel="stylesheet" href="{% static 'adminManager/css/list_datasets.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'adminManager/css/source_data.css' %}" type="text/css">

<div class="button-bar">
    {% if perms.adminManager.add_adminsource %}
    <a class="button small" onclick="openAddDatasetPopup()">+ Add New Dataset</a>
    {% endif %}
</div>

<div class="datasets-container">

    {% for source,stats in datasets %}

        <div class="dataset-card box">
            <a href="{% url 'dataset' source.pk %}">
                <h3 class="title">
                    {{ source.name }}
                </h3>
                <img class="image" src="{% static 'images/dataset.png' %}">
                <div class="details">
                    {% comment %}<div>{{ source.all_admins.count }} boundaries</div>{% endcomment %}
                    <div>
                        <div style="margin-bottom:3px">Input files:</div>
                        <div class="import-stats">
                        {% with allstatus='Pending Importing Failed Imported' %}
                        {% for status in allstatus.split %}
                            {% for key,count in stats.status_counts.items %}
                                {% if key == status and count %}
                                    <span class="importer-status" data-status="{{ status }}">{{ count }} {{ status }}</span>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                        {% endwith %}
                        </div>
                    </div>
                </div>
            </a>
        </div>

    {% endfor %}

</div>


<!----------------------->
<!-- Popups -->

<!-- Add dataset -->

<div id="add-dataset-popup" class="popup is-hidden">
    <div class="popup-content" style="overflow:auto">

        <div class="popup-buttons">
            <a class="close-popup" onclick="closeAddDatasetPopup()">x</a>
        </div>

        {% include 'adminManager/add_dataset.html' with form=add_dataset_form %}

    </div>
</div>

<script>
    function openAddDatasetPopup() {
        document.getElementById('add-dataset-popup').className = 'popup';
    }
    function closeAddDatasetPopup() {
        document.getElementById('add-dataset-popup').className = 'popup is-hidden';
    }
</script>
